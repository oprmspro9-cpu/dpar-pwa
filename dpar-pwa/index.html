<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DPAR Submission</title>
  <style>
    body { 
      font-family: "Segoe UI", Roboto, Arial, sans-serif; 
      margin:10px; 
      background-color:#f4f7fb; 
      color:#1b2a4e;
    }
    h2 { 
      text-align:center; 
      color:#0d47a1; 
      text-transform:uppercase; 
      letter-spacing:2px;
      margin-bottom:20px;
    }
    form {
      width:100%;
      max-width:500px; 
      margin:auto; 
      background-color:#ffffff; 
      padding:20px; 
      border-radius:10px; 
      box-shadow:0 0 15px rgba(0,0,0,0.15);
      box-sizing:border-box;
    }
    label {
      font-weight:bold;
      text-transform:uppercase;
      font-size:12px;
      margin-top:10px;
      color:#0d47a1;
    }
    input, select, button {
      display:block; 
      margin:5px 0 15px 0; 
      padding:12px; 
      width:100%; 
      border-radius:5px; 
      border:1px solid #b0bec5; 
      font-size:16px; 
      background-color:#f9fbfd; 
      color:#1b2a4e;
      box-sizing:border-box;
      transition: border 0.2s, box-shadow 0.2s;
    }
    input:focus, select:focus {
      border-color:#0d47a1;
      box-shadow:0 0 5px rgba(13,71,161,0.3);
      outline:none;
    }
    input:read-only { background-color:#eceff1; cursor:not-allowed; }
    button { 
      width:100%; 
      padding:14px 0; 
      background-color:#0d47a1; 
      color:#fff; 
      font-weight:bold;
      font-size:16px;
      cursor:pointer;
      transition:0.2s;
      border:none;
    }
    button:disabled { background-color:#90a4ae; cursor:not-allowed; }
    button:hover:not(:disabled) { background-color:#1565c0; }
    .nav { text-align:center; margin:20px; }
    .nav a {
      display:inline-block; 
      background:#1565c0; 
      color:#fff; 
      padding:12px 20px; 
      border-radius:8px; 
      text-decoration:none; 
      font-weight:bold;
      transition:background 0.2s;
    }
    .nav a:hover { background:#0d47a1; }
  </style>
</head>
<body>
  <h2>DPAR Submission</h2>

  <div class="nav">
    <a href="submissions.html">ðŸ“Š View Submissions</a>
  </div>

  <form id="dparForm">
    <label>Transacted Date / Received</label>
    <input type="text" name="dateTime" id="dateTime" readonly required>

    <label>Unit</label>
    <select name="unit" id="unit" required>
      <option value="" disabled selected>Select Unit</option>
      <option value="ICPS">ICPS</option>
      <option value="ZCPO">ZCPO</option>
      <option value="ZSBPPO">ZSBPPO</option>
      <option value="ZSPPO">ZSPPO</option>
      <option value="ZNPPO">ZNPPO</option>
      <option value="RMFB">RMFB</option>
      <option value="RHQ">RHQ</option>
    </select>

    <label>Station</label>
    <input type="text" name="station" placeholder="Station" required>

    <label>Total Strength</label>
    <input type="number" name="totalStrength" placeholder="Total Strength" required>

    <label>Actual Present</label>
    <input type="number" name="actualPresent" placeholder="Actual Present" required>

    <label>Authorized Absent</label>
    <input type="number" name="authorizeAbsent" placeholder="Authorized Absent" required>

    <label>Absent</label>
    <input type="number" name="absent" placeholder="Absent" required>

    <label>Station Commander</label>
    <input type="text" name="stationCommander" placeholder="Station Commander" required>

    <label>Action Personnel</label>
    <input type="text" name="actionPersonnel" placeholder="Action Personnel" required>

    <label>Contact Info</label>
    <input type="text" name="contact" placeholder="Contact Info" required>

    <label>Attachment (PDF)</label>
    <input type="file" name="attachment" accept="application/pdf" required>

    <button type="submit" id="submitBtn" disabled>Submit Report</button>
  </form>

  <script>
    const form = document.getElementById('dparForm');
    const btn = document.getElementById('submitBtn');
    const requiredInputs = Array.from(form.querySelectorAll('input[required], select[required]'));

    // Auto-fill Date/Time
    function setCurrentDateTime() {
      const now = new Date();
      const tzOffset = now.getTimezoneOffset() * 60000;
      const localISOTime = new Date(now - tzOffset).toISOString().slice(0,16);
      document.getElementById('dateTime').value = localISOTime.replace("T"," ");
    }
    setCurrentDateTime();

    // Enable button only when all fields are filled
    function checkForm() {
      let allFilled = requiredInputs.every(input => {
        if (input.type === "file") return input.files.length > 0;
        return input.value.trim() !== "";
      });
      btn.disabled = !allFilled;
    }
    requiredInputs.forEach(input => input.addEventListener('input', checkForm));
    requiredInputs.forEach(input => input.addEventListener('change', checkForm));

    // Submit Handler
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      btn.disabled = true;
      btn.textContent = 'Submitting...';

      const formData = new FormData(form);

      try {
        const scriptURL = "YOUR_GOOGLE_APPS_SCRIPT_WEBAPP_URL"; // <-- paste your Apps Script Web App URL
        const response = await fetch(scriptURL, {
          method: "POST",
          body: formData
        });

        const text = await response.text();
        alert(text);

        if (text.includes("âœ…")) {
          form.reset();
          setCurrentDateTime();
          checkForm();
        }
      } catch (err) {
        alert("âŒ Submission failed: " + err.message);
      } finally {
        btn.disabled = false;
        btn.textContent = "Submit Report";
      }
    });

    checkForm();
  </script>
</body>
</html>
